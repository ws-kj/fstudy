{"ast":null,"code":"var onimport = function onimport(i, result) {\n  result.push('import \"' + i + '\";', '');\n  return result;\n};\n\nvar onfield = function onfield(f, result) {\n  var prefix = f.repeated ? 'repeated' : f.required ? 'required' : 'optional';\n  if (f.type === 'map') prefix = 'map<' + f.map.from + ',' + f.map.to + '>';\n  if (f.oneof) prefix = '';\n  var opts = Object.keys(f.options || {}).map(function (key) {\n    return key + ' = ' + f.options[key];\n  }).join(',');\n  if (opts) opts = ' [' + opts + ']';\n  result.push((prefix ? prefix + ' ' : '') + (f.map === 'map' ? '' : f.type + ' ') + f.name + ' = ' + f.tag + opts + ';');\n  return result;\n};\n\nvar onmessage = function onmessage(m, result) {\n  result.push('message ' + m.name + ' {');\n  if (!m.options) m.options = {};\n  onoption(m.options, result);\n  if (!m.enums) m.enums = [];\n  m.enums.forEach(function (e) {\n    result.push(onenum(e, []));\n  });\n  if (!m.messages) m.messages = [];\n  m.messages.forEach(function (m) {\n    result.push(onmessage(m, []));\n  });\n  var oneofs = {};\n  if (!m.fields) m.fields = [];\n  m.fields.forEach(function (f) {\n    if (f.oneof) {\n      if (!oneofs[f.oneof]) oneofs[f.oneof] = [];\n      oneofs[f.oneof].push(onfield(f, []));\n    } else {\n      result.push(onfield(f, []));\n    }\n  });\n  Object.keys(oneofs).forEach(function (n) {\n    oneofs[n].unshift('oneof ' + n + ' {');\n    oneofs[n].push('}');\n    result.push(oneofs[n]);\n  });\n  result.push('}', '');\n  return result;\n};\n\nvar onenum = function onenum(e, result) {\n  result.push('enum ' + e.name + ' {');\n  if (!e.options) e.options = {};\n  var options = onoption(e.options, []);\n\n  if (options.length > 1) {\n    result.push(options.slice(0, -1));\n  }\n\n  Object.keys(e.values).map(function (v) {\n    var val = onenumvalue(e.values[v]);\n    result.push([v + ' = ' + val + ';']);\n  });\n  result.push('}', '');\n  return result;\n};\n\nvar onenumvalue = function onenumvalue(v, result) {\n  var opts = Object.keys(v.options || {}).map(function (key) {\n    return key + ' = ' + v.options[key];\n  }).join(',');\n  if (opts) opts = ' [' + opts + ']';\n  var val = v.value + opts;\n  return val;\n};\n\nvar onoption = function onoption(o, result) {\n  var keys = Object.keys(o);\n  keys.forEach(function (option) {\n    var v = o[option];\n    if (~option.indexOf('.')) option = '(' + option + ')';\n    var type = typeof v;\n\n    if (type === 'object') {\n      v = onoptionMap(v, []);\n      if (v.length) result.push('option ' + option + ' = {', v, '};');\n    } else {\n      if (type === 'string' && option !== 'optimize_for') v = '\"' + v + '\"';\n      result.push('option ' + option + ' = ' + v + ';');\n    }\n  });\n\n  if (keys.length > 0) {\n    result.push('');\n  }\n\n  return result;\n};\n\nvar onoptionMap = function onoptionMap(o, result) {\n  var keys = Object.keys(o);\n  keys.forEach(function (k) {\n    var v = o[k];\n    var type = typeof v;\n\n    if (type === 'object') {\n      if (Array.isArray(v)) {\n        v.forEach(function (v) {\n          v = onoptionMap(v, []);\n          if (v.length) result.push(k + ' {', v, '}');\n        });\n      } else {\n        v = onoptionMap(v, []);\n        if (v.length) result.push(k + ' {', v, '}');\n      }\n    } else {\n      if (type === 'string') v = '\"' + v + '\"';\n      result.push(k + ': ' + v);\n    }\n  });\n  return result;\n};\n\nvar onservices = function onservices(s, result) {\n  result.push('service ' + s.name + ' {');\n  if (!s.options) s.options = {};\n  onoption(s.options, result);\n  if (!s.methods) s.methods = [];\n  s.methods.forEach(function (m) {\n    result.push(onrpc(m, []));\n  });\n  result.push('}', '');\n  return result;\n};\n\nvar onrpc = function onrpc(rpc, result) {\n  var def = 'rpc ' + rpc.name + '(';\n  if (rpc.client_streaming) def += 'stream ';\n  def += rpc.input_type + ') returns (';\n  if (rpc.server_streaming) def += 'stream ';\n  def += rpc.output_type + ')';\n  if (!rpc.options) rpc.options = {};\n  var options = onoption(rpc.options, []);\n\n  if (options.length > 1) {\n    result.push(def + ' {', options.slice(0, -1), '}');\n  } else {\n    result.push(def + ';');\n  }\n\n  return result;\n};\n\nvar indent = function indent(lvl) {\n  return function (line) {\n    if (Array.isArray(line)) return line.map(indent(lvl + '  ')).join('\\n');\n    return lvl + line;\n  };\n};\n\nmodule.exports = function (schema) {\n  var result = [];\n  result.push('syntax = \"proto' + schema.syntax + '\";', '');\n  if (schema.package) result.push('package ' + schema.package + ';', '');\n\n  if (schema.imports) {\n    schema.imports.forEach(function (i) {\n      onimport(i, result);\n    });\n  }\n\n  if (!schema.options) schema.options = {};\n  onoption(schema.options, result);\n  if (!schema.enums) schema.enums = [];\n  schema.enums.forEach(function (e) {\n    onenum(e, result);\n  });\n  if (!schema.messages) schema.messages = [];\n  schema.messages.forEach(function (m) {\n    onmessage(m, result);\n  });\n\n  if (schema.services) {\n    schema.services.forEach(function (s) {\n      onservices(s, result);\n    });\n  }\n\n  return result.map(indent('')).join('\\n');\n};","map":{"version":3,"sources":["/home/wskj/src/node_modules/protocol-buffers-schema/stringify.js"],"names":["onimport","i","result","push","onfield","f","prefix","repeated","required","type","map","from","to","oneof","opts","Object","keys","options","key","join","name","tag","onmessage","m","onoption","enums","forEach","e","onenum","messages","oneofs","fields","n","unshift","length","slice","values","v","val","onenumvalue","value","o","option","indexOf","onoptionMap","k","Array","isArray","onservices","s","methods","onrpc","rpc","def","client_streaming","input_type","server_streaming","output_type","indent","lvl","line","module","exports","schema","syntax","package","imports","services"],"mappings":"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","sourcesContent":["var onimport = function (i, result) {\n  result.push('import \"' + i + '\";', '')\n  return result\n}\n\nvar onfield = function (f, result) {\n  var prefix = f.repeated ? 'repeated' : f.required ? 'required' : 'optional'\n  if (f.type === 'map') prefix = 'map<' + f.map.from + ',' + f.map.to + '>'\n  if (f.oneof) prefix = ''\n\n  var opts = Object.keys(f.options || {}).map(function (key) {\n    return key + ' = ' + f.options[key]\n  }).join(',')\n\n  if (opts) opts = ' [' + opts + ']'\n\n  result.push((prefix ? prefix + ' ' : '') + (f.map === 'map' ? '' : f.type + ' ') + f.name + ' = ' + f.tag + opts + ';')\n  return result\n}\n\nvar onmessage = function (m, result) {\n  result.push('message ' + m.name + ' {')\n\n  if (!m.options) m.options = {}\n  onoption(m.options, result)\n\n  if (!m.enums) m.enums = []\n  m.enums.forEach(function (e) {\n    result.push(onenum(e, []))\n  })\n\n  if (!m.messages) m.messages = []\n  m.messages.forEach(function (m) {\n    result.push(onmessage(m, []))\n  })\n\n  var oneofs = {}\n\n  if (!m.fields) m.fields = []\n  m.fields.forEach(function (f) {\n    if (f.oneof) {\n      if (!oneofs[f.oneof]) oneofs[f.oneof] = []\n      oneofs[f.oneof].push(onfield(f, []))\n    } else {\n      result.push(onfield(f, []))\n    }\n  })\n\n  Object.keys(oneofs).forEach(function (n) {\n    oneofs[n].unshift('oneof ' + n + ' {')\n    oneofs[n].push('}')\n    result.push(oneofs[n])\n  })\n\n  result.push('}', '')\n  return result\n}\n\nvar onenum = function (e, result) {\n  result.push('enum ' + e.name + ' {')\n  if (!e.options) e.options = {}\n  var options = onoption(e.options, [])\n  if (options.length > 1) {\n    result.push(options.slice(0, -1))\n  }\n  Object.keys(e.values).map(function (v) {\n    var val = onenumvalue(e.values[v])\n    result.push([v + ' = ' + val + ';'])\n  })\n  result.push('}', '')\n  return result\n}\n\nvar onenumvalue = function (v, result) {\n  var opts = Object.keys(v.options || {}).map(function (key) {\n    return key + ' = ' + v.options[key]\n  }).join(',')\n\n  if (opts) opts = ' [' + opts + ']'\n  var val = v.value + opts\n  return val\n}\n\nvar onoption = function (o, result) {\n  var keys = Object.keys(o)\n  keys.forEach(function (option) {\n    var v = o[option]\n    if (~option.indexOf('.')) option = '(' + option + ')'\n\n    var type = typeof v\n\n    if (type === 'object') {\n      v = onoptionMap(v, [])\n      if (v.length) result.push('option ' + option + ' = {', v, '};')\n    } else {\n      if (type === 'string' && option !== 'optimize_for') v = '\"' + v + '\"'\n      result.push('option ' + option + ' = ' + v + ';')\n    }\n  })\n  if (keys.length > 0) {\n    result.push('')\n  }\n\n  return result\n}\n\nvar onoptionMap = function (o, result) {\n  var keys = Object.keys(o)\n  keys.forEach(function (k) {\n    var v = o[k]\n\n    var type = typeof v\n\n    if (type === 'object') {\n      if (Array.isArray(v)) {\n        v.forEach(function (v) {\n          v = onoptionMap(v, [])\n          if (v.length) result.push(k + ' {', v, '}')\n        })\n      } else {\n        v = onoptionMap(v, [])\n        if (v.length) result.push(k + ' {', v, '}')\n      }\n    } else {\n      if (type === 'string') v = '\"' + v + '\"'\n      result.push(k + ': ' + v)\n    }\n  })\n\n  return result\n}\n\nvar onservices = function (s, result) {\n  result.push('service ' + s.name + ' {')\n\n  if (!s.options) s.options = {}\n  onoption(s.options, result)\n  if (!s.methods) s.methods = []\n  s.methods.forEach(function (m) {\n    result.push(onrpc(m, []))\n  })\n\n  result.push('}', '')\n  return result\n}\n\nvar onrpc = function (rpc, result) {\n  var def = 'rpc ' + rpc.name + '('\n  if (rpc.client_streaming) def += 'stream '\n  def += rpc.input_type + ') returns ('\n  if (rpc.server_streaming) def += 'stream '\n  def += rpc.output_type + ')'\n\n  if (!rpc.options) rpc.options = {}\n\n  var options = onoption(rpc.options, [])\n  if (options.length > 1) {\n    result.push(def + ' {', options.slice(0, -1), '}')\n  } else {\n    result.push(def + ';')\n  }\n\n  return result\n}\n\nvar indent = function (lvl) {\n  return function (line) {\n    if (Array.isArray(line)) return line.map(indent(lvl + '  ')).join('\\n')\n    return lvl + line\n  }\n}\n\nmodule.exports = function (schema) {\n  var result = []\n\n  result.push('syntax = \"proto' + schema.syntax + '\";', '')\n\n  if (schema.package) result.push('package ' + schema.package + ';', '')\n\n  if (schema.imports) {\n    schema.imports.forEach(function (i) {\n      onimport(i, result)\n    })\n  }\n\n  if (!schema.options) schema.options = {}\n\n  onoption(schema.options, result)\n\n  if (!schema.enums) schema.enums = []\n  schema.enums.forEach(function (e) {\n    onenum(e, result)\n  })\n\n  if (!schema.messages) schema.messages = []\n  schema.messages.forEach(function (m) {\n    onmessage(m, result)\n  })\n\n  if (schema.services) {\n    schema.services.forEach(function (s) {\n      onservices(s, result)\n    })\n  }\n  return result.map(indent('')).join('\\n')\n}\n"]},"metadata":{},"sourceType":"script"}