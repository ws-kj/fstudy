{"ast":null,"code":"'use strict';\n\nvar _classCallCheck = require(\"/home/wskj/src/fstudy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/home/wskj/src/fstudy/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\nvar _require = require('buffer'),\n    Buffer = _require.Buffer;\n\nvar ieee754 = require('ieee754');\n\nvar Bignumber = require('bignumber.js').BigNumber;\n\nvar parser = require('./decoder.asm');\n\nvar utils = require('./utils');\n\nvar c = require('./constants');\n\nvar Simple = require('./simple');\n\nvar Tagged = require('./tagged');\n\nvar _require2 = require('iso-url'),\n    URL = _require2.URL;\n/**\n * Transform binary cbor data into JavaScript objects.\n */\n\n\nvar Decoder = /*#__PURE__*/function () {\n  /**\n   * @param {Object} [opts={}]\n   * @param {number} [opts.size=65536] - Size of the allocated heap.\n   */\n  function Decoder(opts) {\n    _classCallCheck(this, Decoder);\n\n    opts = opts || {};\n\n    if (!opts.size || opts.size < 0x10000) {\n      opts.size = 0x10000;\n    } else {\n      // Ensure the size is a power of 2\n      opts.size = utils.nextPowerOf2(opts.size);\n    } // Heap use to share the input with the parser\n\n\n    this._heap = new ArrayBuffer(opts.size);\n    this._heap8 = new Uint8Array(this._heap);\n    this._buffer = Buffer.from(this._heap);\n\n    this._reset(); // Known tags\n\n\n    this._knownTags = Object.assign({\n      0: function _(val) {\n        return new Date(val);\n      },\n      1: function _(val) {\n        return new Date(val * 1000);\n      },\n      2: function _(val) {\n        return utils.arrayBufferToBignumber(val);\n      },\n      3: function _(val) {\n        return c.NEG_ONE.minus(utils.arrayBufferToBignumber(val));\n      },\n      4: function _(v) {\n        // const v = new Uint8Array(val)\n        return c.TEN.pow(v[0]).times(v[1]);\n      },\n      5: function _(v) {\n        // const v = new Uint8Array(val)\n        return c.TWO.pow(v[0]).times(v[1]);\n      },\n      32: function _(val) {\n        return new URL(val);\n      },\n      35: function _(val) {\n        return new RegExp(val);\n      }\n    }, opts.tags); // Initialize asm based parser\n\n    this.parser = parser(global, {\n      // eslint-disable-next-line no-console\n      log: console.log.bind(console),\n      pushInt: this.pushInt.bind(this),\n      pushInt32: this.pushInt32.bind(this),\n      pushInt32Neg: this.pushInt32Neg.bind(this),\n      pushInt64: this.pushInt64.bind(this),\n      pushInt64Neg: this.pushInt64Neg.bind(this),\n      pushFloat: this.pushFloat.bind(this),\n      pushFloatSingle: this.pushFloatSingle.bind(this),\n      pushFloatDouble: this.pushFloatDouble.bind(this),\n      pushTrue: this.pushTrue.bind(this),\n      pushFalse: this.pushFalse.bind(this),\n      pushUndefined: this.pushUndefined.bind(this),\n      pushNull: this.pushNull.bind(this),\n      pushInfinity: this.pushInfinity.bind(this),\n      pushInfinityNeg: this.pushInfinityNeg.bind(this),\n      pushNaN: this.pushNaN.bind(this),\n      pushNaNNeg: this.pushNaNNeg.bind(this),\n      pushArrayStart: this.pushArrayStart.bind(this),\n      pushArrayStartFixed: this.pushArrayStartFixed.bind(this),\n      pushArrayStartFixed32: this.pushArrayStartFixed32.bind(this),\n      pushArrayStartFixed64: this.pushArrayStartFixed64.bind(this),\n      pushObjectStart: this.pushObjectStart.bind(this),\n      pushObjectStartFixed: this.pushObjectStartFixed.bind(this),\n      pushObjectStartFixed32: this.pushObjectStartFixed32.bind(this),\n      pushObjectStartFixed64: this.pushObjectStartFixed64.bind(this),\n      pushByteString: this.pushByteString.bind(this),\n      pushByteStringStart: this.pushByteStringStart.bind(this),\n      pushUtf8String: this.pushUtf8String.bind(this),\n      pushUtf8StringStart: this.pushUtf8StringStart.bind(this),\n      pushSimpleUnassigned: this.pushSimpleUnassigned.bind(this),\n      pushTagUnassigned: this.pushTagUnassigned.bind(this),\n      pushTagStart: this.pushTagStart.bind(this),\n      pushTagStart4: this.pushTagStart4.bind(this),\n      pushTagStart8: this.pushTagStart8.bind(this),\n      pushBreak: this.pushBreak.bind(this)\n    }, this._heap);\n  }\n\n  _createClass(Decoder, [{\n    key: \"_depth\",\n    get: function get() {\n      return this._parents.length;\n    }\n  }, {\n    key: \"_currentParent\",\n    get: function get() {\n      return this._parents[this._depth - 1];\n    }\n  }, {\n    key: \"_ref\",\n    get: function get() {\n      return this._currentParent.ref;\n    } // Finish the current parent\n\n  }, {\n    key: \"_closeParent\",\n    value: function _closeParent() {\n      var p = this._parents.pop();\n\n      if (p.length > 0) {\n        throw new Error(\"Missing \".concat(p.length, \" elements\"));\n      }\n\n      switch (p.type) {\n        case c.PARENT.TAG:\n          this._push(this.createTag(p.ref[0], p.ref[1]));\n\n          break;\n\n        case c.PARENT.BYTE_STRING:\n          this._push(this.createByteString(p.ref, p.length));\n\n          break;\n\n        case c.PARENT.UTF8_STRING:\n          this._push(this.createUtf8String(p.ref, p.length));\n\n          break;\n\n        case c.PARENT.MAP:\n          if (p.values % 2 > 0) {\n            throw new Error('Odd number of elements in the map');\n          }\n\n          this._push(this.createMap(p.ref, p.length));\n\n          break;\n\n        case c.PARENT.OBJECT:\n          if (p.values % 2 > 0) {\n            throw new Error('Odd number of elements in the map');\n          }\n\n          this._push(this.createObject(p.ref, p.length));\n\n          break;\n\n        case c.PARENT.ARRAY:\n          this._push(this.createArray(p.ref, p.length));\n\n          break;\n\n        default:\n          break;\n      }\n\n      if (this._currentParent && this._currentParent.type === c.PARENT.TAG) {\n        this._dec();\n      }\n    } // Reduce the expected length of the current parent by one\n\n  }, {\n    key: \"_dec\",\n    value: function _dec() {\n      var p = this._currentParent; // The current parent does not know the epxected child length\n\n      if (p.length < 0) {\n        return;\n      }\n\n      p.length--; // All children were seen, we can close the current parent\n\n      if (p.length === 0) {\n        this._closeParent();\n      }\n    } // Push any value to the current parent\n\n  }, {\n    key: \"_push\",\n    value: function _push(val, hasChildren) {\n      var p = this._currentParent;\n      p.values++;\n\n      switch (p.type) {\n        case c.PARENT.ARRAY:\n        case c.PARENT.BYTE_STRING:\n        case c.PARENT.UTF8_STRING:\n          if (p.length > -1) {\n            this._ref[this._ref.length - p.length] = val;\n          } else {\n            this._ref.push(val);\n          }\n\n          this._dec();\n\n          break;\n\n        case c.PARENT.OBJECT:\n          if (p.tmpKey != null) {\n            this._ref[p.tmpKey] = val;\n            p.tmpKey = null;\n\n            this._dec();\n          } else {\n            p.tmpKey = val;\n\n            if (typeof p.tmpKey !== 'string') {\n              // too bad, convert to a Map\n              p.type = c.PARENT.MAP;\n              p.ref = utils.buildMap(p.ref);\n            }\n          }\n\n          break;\n\n        case c.PARENT.MAP:\n          if (p.tmpKey != null) {\n            this._ref.set(p.tmpKey, val);\n\n            p.tmpKey = null;\n\n            this._dec();\n          } else {\n            p.tmpKey = val;\n          }\n\n          break;\n\n        case c.PARENT.TAG:\n          this._ref.push(val);\n\n          if (!hasChildren) {\n            this._dec();\n          }\n\n          break;\n\n        default:\n          throw new Error('Unknown parent type');\n      }\n    } // Create a new parent in the parents list\n\n  }, {\n    key: \"_createParent\",\n    value: function _createParent(obj, type, len) {\n      this._parents[this._depth] = {\n        type: type,\n        length: len,\n        ref: obj,\n        values: 0,\n        tmpKey: null\n      };\n    } // Reset all state back to the beginning, also used for initiatlization\n\n  }, {\n    key: \"_reset\",\n    value: function _reset() {\n      this._res = [];\n      this._parents = [{\n        type: c.PARENT.ARRAY,\n        length: -1,\n        ref: this._res,\n        values: 0,\n        tmpKey: null\n      }];\n    } // -- Interface to customize deoding behaviour\n\n  }, {\n    key: \"createTag\",\n    value: function createTag(tagNumber, value) {\n      var typ = this._knownTags[tagNumber];\n\n      if (!typ) {\n        return new Tagged(tagNumber, value);\n      }\n\n      return typ(value);\n    }\n  }, {\n    key: \"createMap\",\n    value: function createMap(obj, len) {\n      return obj;\n    }\n  }, {\n    key: \"createObject\",\n    value: function createObject(obj, len) {\n      return obj;\n    }\n  }, {\n    key: \"createArray\",\n    value: function createArray(arr, len) {\n      return arr;\n    }\n  }, {\n    key: \"createByteString\",\n    value: function createByteString(raw, len) {\n      return Buffer.concat(raw);\n    }\n  }, {\n    key: \"createByteStringFromHeap\",\n    value: function createByteStringFromHeap(start, end) {\n      if (start === end) {\n        return Buffer.alloc(0);\n      }\n\n      return Buffer.from(this._heap.slice(start, end));\n    }\n  }, {\n    key: \"createInt\",\n    value: function createInt(val) {\n      return val;\n    }\n  }, {\n    key: \"createInt32\",\n    value: function createInt32(f, g) {\n      return utils.buildInt32(f, g);\n    }\n  }, {\n    key: \"createInt64\",\n    value: function createInt64(f1, f2, g1, g2) {\n      return utils.buildInt64(f1, f2, g1, g2);\n    }\n  }, {\n    key: \"createFloat\",\n    value: function createFloat(val) {\n      return val;\n    }\n  }, {\n    key: \"createFloatSingle\",\n    value: function createFloatSingle(a, b, c, d) {\n      return ieee754.read([a, b, c, d], 0, false, 23, 4);\n    }\n  }, {\n    key: \"createFloatDouble\",\n    value: function createFloatDouble(a, b, c, d, e, f, g, h) {\n      return ieee754.read([a, b, c, d, e, f, g, h], 0, false, 52, 8);\n    }\n  }, {\n    key: \"createInt32Neg\",\n    value: function createInt32Neg(f, g) {\n      return -1 - utils.buildInt32(f, g);\n    }\n  }, {\n    key: \"createInt64Neg\",\n    value: function createInt64Neg(f1, f2, g1, g2) {\n      var f = utils.buildInt32(f1, f2);\n      var g = utils.buildInt32(g1, g2);\n\n      if (f > c.MAX_SAFE_HIGH) {\n        return c.NEG_ONE.minus(new Bignumber(f).times(c.SHIFT32).plus(g));\n      }\n\n      return -1 - (f * c.SHIFT32 + g);\n    }\n  }, {\n    key: \"createTrue\",\n    value: function createTrue() {\n      return true;\n    }\n  }, {\n    key: \"createFalse\",\n    value: function createFalse() {\n      return false;\n    }\n  }, {\n    key: \"createNull\",\n    value: function createNull() {\n      return null;\n    }\n  }, {\n    key: \"createUndefined\",\n    value: function createUndefined() {\n      return undefined;\n    }\n  }, {\n    key: \"createInfinity\",\n    value: function createInfinity() {\n      return Infinity;\n    }\n  }, {\n    key: \"createInfinityNeg\",\n    value: function createInfinityNeg() {\n      return -Infinity;\n    }\n  }, {\n    key: \"createNaN\",\n    value: function createNaN() {\n      return NaN;\n    }\n  }, {\n    key: \"createNaNNeg\",\n    value: function createNaNNeg() {\n      return -NaN;\n    }\n  }, {\n    key: \"createUtf8String\",\n    value: function createUtf8String(raw, len) {\n      return raw.join('');\n    }\n  }, {\n    key: \"createUtf8StringFromHeap\",\n    value: function createUtf8StringFromHeap(start, end) {\n      if (start === end) {\n        return '';\n      }\n\n      return this._buffer.toString('utf8', start, end);\n    }\n  }, {\n    key: \"createSimpleUnassigned\",\n    value: function createSimpleUnassigned(val) {\n      return new Simple(val);\n    } // -- Interface for decoder.asm.js\n\n  }, {\n    key: \"pushInt\",\n    value: function pushInt(val) {\n      this._push(this.createInt(val));\n    }\n  }, {\n    key: \"pushInt32\",\n    value: function pushInt32(f, g) {\n      this._push(this.createInt32(f, g));\n    }\n  }, {\n    key: \"pushInt64\",\n    value: function pushInt64(f1, f2, g1, g2) {\n      this._push(this.createInt64(f1, f2, g1, g2));\n    }\n  }, {\n    key: \"pushFloat\",\n    value: function pushFloat(val) {\n      this._push(this.createFloat(val));\n    }\n  }, {\n    key: \"pushFloatSingle\",\n    value: function pushFloatSingle(a, b, c, d) {\n      this._push(this.createFloatSingle(a, b, c, d));\n    }\n  }, {\n    key: \"pushFloatDouble\",\n    value: function pushFloatDouble(a, b, c, d, e, f, g, h) {\n      this._push(this.createFloatDouble(a, b, c, d, e, f, g, h));\n    }\n  }, {\n    key: \"pushInt32Neg\",\n    value: function pushInt32Neg(f, g) {\n      this._push(this.createInt32Neg(f, g));\n    }\n  }, {\n    key: \"pushInt64Neg\",\n    value: function pushInt64Neg(f1, f2, g1, g2) {\n      this._push(this.createInt64Neg(f1, f2, g1, g2));\n    }\n  }, {\n    key: \"pushTrue\",\n    value: function pushTrue() {\n      this._push(this.createTrue());\n    }\n  }, {\n    key: \"pushFalse\",\n    value: function pushFalse() {\n      this._push(this.createFalse());\n    }\n  }, {\n    key: \"pushNull\",\n    value: function pushNull() {\n      this._push(this.createNull());\n    }\n  }, {\n    key: \"pushUndefined\",\n    value: function pushUndefined() {\n      this._push(this.createUndefined());\n    }\n  }, {\n    key: \"pushInfinity\",\n    value: function pushInfinity() {\n      this._push(this.createInfinity());\n    }\n  }, {\n    key: \"pushInfinityNeg\",\n    value: function pushInfinityNeg() {\n      this._push(this.createInfinityNeg());\n    }\n  }, {\n    key: \"pushNaN\",\n    value: function pushNaN() {\n      this._push(this.createNaN());\n    }\n  }, {\n    key: \"pushNaNNeg\",\n    value: function pushNaNNeg() {\n      this._push(this.createNaNNeg());\n    }\n  }, {\n    key: \"pushArrayStart\",\n    value: function pushArrayStart() {\n      this._createParent([], c.PARENT.ARRAY, -1);\n    }\n  }, {\n    key: \"pushArrayStartFixed\",\n    value: function pushArrayStartFixed(len) {\n      this._createArrayStartFixed(len);\n    }\n  }, {\n    key: \"pushArrayStartFixed32\",\n    value: function pushArrayStartFixed32(len1, len2) {\n      var len = utils.buildInt32(len1, len2);\n\n      this._createArrayStartFixed(len);\n    }\n  }, {\n    key: \"pushArrayStartFixed64\",\n    value: function pushArrayStartFixed64(len1, len2, len3, len4) {\n      var len = utils.buildInt64(len1, len2, len3, len4);\n\n      this._createArrayStartFixed(len);\n    }\n  }, {\n    key: \"pushObjectStart\",\n    value: function pushObjectStart() {\n      this._createObjectStartFixed(-1);\n    }\n  }, {\n    key: \"pushObjectStartFixed\",\n    value: function pushObjectStartFixed(len) {\n      this._createObjectStartFixed(len);\n    }\n  }, {\n    key: \"pushObjectStartFixed32\",\n    value: function pushObjectStartFixed32(len1, len2) {\n      var len = utils.buildInt32(len1, len2);\n\n      this._createObjectStartFixed(len);\n    }\n  }, {\n    key: \"pushObjectStartFixed64\",\n    value: function pushObjectStartFixed64(len1, len2, len3, len4) {\n      var len = utils.buildInt64(len1, len2, len3, len4);\n\n      this._createObjectStartFixed(len);\n    }\n  }, {\n    key: \"pushByteStringStart\",\n    value: function pushByteStringStart() {\n      this._parents[this._depth] = {\n        type: c.PARENT.BYTE_STRING,\n        length: -1,\n        ref: [],\n        values: 0,\n        tmpKey: null\n      };\n    }\n  }, {\n    key: \"pushByteString\",\n    value: function pushByteString(start, end) {\n      this._push(this.createByteStringFromHeap(start, end));\n    }\n  }, {\n    key: \"pushUtf8StringStart\",\n    value: function pushUtf8StringStart() {\n      this._parents[this._depth] = {\n        type: c.PARENT.UTF8_STRING,\n        length: -1,\n        ref: [],\n        values: 0,\n        tmpKey: null\n      };\n    }\n  }, {\n    key: \"pushUtf8String\",\n    value: function pushUtf8String(start, end) {\n      this._push(this.createUtf8StringFromHeap(start, end));\n    }\n  }, {\n    key: \"pushSimpleUnassigned\",\n    value: function pushSimpleUnassigned(val) {\n      this._push(this.createSimpleUnassigned(val));\n    }\n  }, {\n    key: \"pushTagStart\",\n    value: function pushTagStart(tag) {\n      this._parents[this._depth] = {\n        type: c.PARENT.TAG,\n        length: 1,\n        ref: [tag]\n      };\n    }\n  }, {\n    key: \"pushTagStart4\",\n    value: function pushTagStart4(f, g) {\n      this.pushTagStart(utils.buildInt32(f, g));\n    }\n  }, {\n    key: \"pushTagStart8\",\n    value: function pushTagStart8(f1, f2, g1, g2) {\n      this.pushTagStart(utils.buildInt64(f1, f2, g1, g2));\n    }\n  }, {\n    key: \"pushTagUnassigned\",\n    value: function pushTagUnassigned(tagNumber) {\n      this._push(this.createTag(tagNumber));\n    }\n  }, {\n    key: \"pushBreak\",\n    value: function pushBreak() {\n      if (this._currentParent.length > -1) {\n        throw new Error('Unexpected break');\n      }\n\n      this._closeParent();\n    }\n  }, {\n    key: \"_createObjectStartFixed\",\n    value: function _createObjectStartFixed(len) {\n      if (len === 0) {\n        this._push(this.createObject({}));\n\n        return;\n      }\n\n      this._createParent({}, c.PARENT.OBJECT, len);\n    }\n  }, {\n    key: \"_createArrayStartFixed\",\n    value: function _createArrayStartFixed(len) {\n      if (len === 0) {\n        this._push(this.createArray([]));\n\n        return;\n      }\n\n      this._createParent(new Array(len), c.PARENT.ARRAY, len);\n    }\n  }, {\n    key: \"_decode\",\n    value: function _decode(input) {\n      if (input.byteLength === 0) {\n        throw new Error('Input too short');\n      }\n\n      this._reset();\n\n      this._heap8.set(input);\n\n      var code = this.parser.parse(input.byteLength);\n\n      if (this._depth > 1) {\n        while (this._currentParent.length === 0) {\n          this._closeParent();\n        }\n\n        if (this._depth > 1) {\n          throw new Error('Undeterminated nesting');\n        }\n      }\n\n      if (code > 0) {\n        throw new Error('Failed to parse');\n      }\n\n      if (this._res.length === 0) {\n        throw new Error('No valid result');\n      }\n    } // -- Public Interface\n\n  }, {\n    key: \"decodeFirst\",\n    value: function decodeFirst(input) {\n      this._decode(input);\n\n      return this._res[0];\n    }\n  }, {\n    key: \"decodeAll\",\n    value: function decodeAll(input) {\n      this._decode(input);\n\n      return this._res;\n    }\n    /**\n     * Decode the first cbor object.\n     *\n     * @param {Buffer|string} input\n     * @param {string} [enc='hex'] - Encoding used if a string is passed.\n     * @returns {*}\n     */\n\n  }], [{\n    key: \"decode\",\n    value: function decode(input, enc) {\n      if (typeof input === 'string') {\n        input = Buffer.from(input, enc || 'hex');\n      }\n\n      var dec = new Decoder({\n        size: input.length\n      });\n      return dec.decodeFirst(input);\n    }\n    /**\n     * Decode all cbor objects.\n     *\n     * @param {Buffer|string} input\n     * @param {string} [enc='hex'] - Encoding used if a string is passed.\n     * @returns {Array<*>}\n     */\n\n  }, {\n    key: \"decodeAll\",\n    value: function decodeAll(input, enc) {\n      if (typeof input === 'string') {\n        input = Buffer.from(input, enc || 'hex');\n      }\n\n      var dec = new Decoder({\n        size: input.length\n      });\n      return dec.decodeAll(input);\n    }\n  }]);\n\n  return Decoder;\n}();\n\nDecoder.decodeFirst = Decoder.decode;\nmodule.exports = Decoder;","map":{"version":3,"sources":["/home/wskj/src/node_modules/borc/src/decoder.js"],"names":["require","Buffer","ieee754","Bignumber","BigNumber","parser","utils","c","Simple","Tagged","URL","Decoder","opts","size","nextPowerOf2","_heap","ArrayBuffer","_heap8","Uint8Array","_buffer","from","_reset","_knownTags","Object","assign","val","Date","arrayBufferToBignumber","NEG_ONE","minus","v","TEN","pow","times","TWO","RegExp","tags","global","log","console","bind","pushInt","pushInt32","pushInt32Neg","pushInt64","pushInt64Neg","pushFloat","pushFloatSingle","pushFloatDouble","pushTrue","pushFalse","pushUndefined","pushNull","pushInfinity","pushInfinityNeg","pushNaN","pushNaNNeg","pushArrayStart","pushArrayStartFixed","pushArrayStartFixed32","pushArrayStartFixed64","pushObjectStart","pushObjectStartFixed","pushObjectStartFixed32","pushObjectStartFixed64","pushByteString","pushByteStringStart","pushUtf8String","pushUtf8StringStart","pushSimpleUnassigned","pushTagUnassigned","pushTagStart","pushTagStart4","pushTagStart8","pushBreak","_parents","length","_depth","_currentParent","ref","p","pop","Error","type","PARENT","TAG","_push","createTag","BYTE_STRING","createByteString","UTF8_STRING","createUtf8String","MAP","values","createMap","OBJECT","createObject","ARRAY","createArray","_dec","_closeParent","hasChildren","_ref","push","tmpKey","buildMap","set","obj","len","_res","tagNumber","value","typ","arr","raw","concat","start","end","alloc","slice","f","g","buildInt32","f1","f2","g1","g2","buildInt64","a","b","d","read","e","h","MAX_SAFE_HIGH","SHIFT32","plus","undefined","Infinity","NaN","join","toString","createInt","createInt32","createInt64","createFloat","createFloatSingle","createFloatDouble","createInt32Neg","createInt64Neg","createTrue","createFalse","createNull","createUndefined","createInfinity","createInfinityNeg","createNaN","createNaNNeg","_createParent","_createArrayStartFixed","len1","len2","len3","len4","_createObjectStartFixed","createByteStringFromHeap","createUtf8StringFromHeap","createSimpleUnassigned","tag","Array","input","byteLength","code","parse","_decode","enc","dec","decodeFirst","decodeAll","decode","module","exports"],"mappings":"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","sourcesContent":["'use strict'\n\nconst { Buffer } = require('buffer')\nconst ieee754 = require('ieee754')\nconst Bignumber = require('bignumber.js').BigNumber\n\nconst parser = require('./decoder.asm')\nconst utils = require('./utils')\nconst c = require('./constants')\nconst Simple = require('./simple')\nconst Tagged = require('./tagged')\nconst { URL } = require('iso-url')\n\n/**\n * Transform binary cbor data into JavaScript objects.\n */\nclass Decoder {\n  /**\n   * @param {Object} [opts={}]\n   * @param {number} [opts.size=65536] - Size of the allocated heap.\n   */\n  constructor (opts) {\n    opts = opts || {}\n\n    if (!opts.size || opts.size < 0x10000) {\n      opts.size = 0x10000\n    } else {\n      // Ensure the size is a power of 2\n      opts.size = utils.nextPowerOf2(opts.size)\n    }\n\n    // Heap use to share the input with the parser\n    this._heap = new ArrayBuffer(opts.size)\n    this._heap8 = new Uint8Array(this._heap)\n    this._buffer = Buffer.from(this._heap)\n\n    this._reset()\n\n    // Known tags\n    this._knownTags = Object.assign({\n      0: (val) => new Date(val),\n      1: (val) => new Date(val * 1000),\n      2: (val) => utils.arrayBufferToBignumber(val),\n      3: (val) => c.NEG_ONE.minus(utils.arrayBufferToBignumber(val)),\n      4: (v) => {\n        // const v = new Uint8Array(val)\n        return c.TEN.pow(v[0]).times(v[1])\n      },\n      5: (v) => {\n        // const v = new Uint8Array(val)\n        return c.TWO.pow(v[0]).times(v[1])\n      },\n      32: (val) => new URL(val),\n      35: (val) => new RegExp(val)\n    }, opts.tags)\n\n    // Initialize asm based parser\n    this.parser = parser(global, {\n      // eslint-disable-next-line no-console\n      log: console.log.bind(console),\n      pushInt: this.pushInt.bind(this),\n      pushInt32: this.pushInt32.bind(this),\n      pushInt32Neg: this.pushInt32Neg.bind(this),\n      pushInt64: this.pushInt64.bind(this),\n      pushInt64Neg: this.pushInt64Neg.bind(this),\n      pushFloat: this.pushFloat.bind(this),\n      pushFloatSingle: this.pushFloatSingle.bind(this),\n      pushFloatDouble: this.pushFloatDouble.bind(this),\n      pushTrue: this.pushTrue.bind(this),\n      pushFalse: this.pushFalse.bind(this),\n      pushUndefined: this.pushUndefined.bind(this),\n      pushNull: this.pushNull.bind(this),\n      pushInfinity: this.pushInfinity.bind(this),\n      pushInfinityNeg: this.pushInfinityNeg.bind(this),\n      pushNaN: this.pushNaN.bind(this),\n      pushNaNNeg: this.pushNaNNeg.bind(this),\n      pushArrayStart: this.pushArrayStart.bind(this),\n      pushArrayStartFixed: this.pushArrayStartFixed.bind(this),\n      pushArrayStartFixed32: this.pushArrayStartFixed32.bind(this),\n      pushArrayStartFixed64: this.pushArrayStartFixed64.bind(this),\n      pushObjectStart: this.pushObjectStart.bind(this),\n      pushObjectStartFixed: this.pushObjectStartFixed.bind(this),\n      pushObjectStartFixed32: this.pushObjectStartFixed32.bind(this),\n      pushObjectStartFixed64: this.pushObjectStartFixed64.bind(this),\n      pushByteString: this.pushByteString.bind(this),\n      pushByteStringStart: this.pushByteStringStart.bind(this),\n      pushUtf8String: this.pushUtf8String.bind(this),\n      pushUtf8StringStart: this.pushUtf8StringStart.bind(this),\n      pushSimpleUnassigned: this.pushSimpleUnassigned.bind(this),\n      pushTagUnassigned: this.pushTagUnassigned.bind(this),\n      pushTagStart: this.pushTagStart.bind(this),\n      pushTagStart4: this.pushTagStart4.bind(this),\n      pushTagStart8: this.pushTagStart8.bind(this),\n      pushBreak: this.pushBreak.bind(this)\n    }, this._heap)\n  }\n\n  get _depth () {\n    return this._parents.length\n  }\n\n  get _currentParent () {\n    return this._parents[this._depth - 1]\n  }\n\n  get _ref () {\n    return this._currentParent.ref\n  }\n\n  // Finish the current parent\n  _closeParent () {\n    var p = this._parents.pop()\n\n    if (p.length > 0) {\n      throw new Error(`Missing ${p.length} elements`)\n    }\n\n    switch (p.type) {\n      case c.PARENT.TAG:\n        this._push(\n          this.createTag(p.ref[0], p.ref[1])\n        )\n        break\n      case c.PARENT.BYTE_STRING:\n        this._push(this.createByteString(p.ref, p.length))\n        break\n      case c.PARENT.UTF8_STRING:\n        this._push(this.createUtf8String(p.ref, p.length))\n        break\n      case c.PARENT.MAP:\n        if (p.values % 2 > 0) {\n          throw new Error('Odd number of elements in the map')\n        }\n        this._push(this.createMap(p.ref, p.length))\n        break\n      case c.PARENT.OBJECT:\n        if (p.values % 2 > 0) {\n          throw new Error('Odd number of elements in the map')\n        }\n        this._push(this.createObject(p.ref, p.length))\n        break\n      case c.PARENT.ARRAY:\n        this._push(this.createArray(p.ref, p.length))\n        break\n      default:\n        break\n    }\n\n    if (this._currentParent && this._currentParent.type === c.PARENT.TAG) {\n      this._dec()\n    }\n  }\n\n  // Reduce the expected length of the current parent by one\n  _dec () {\n    const p = this._currentParent\n    // The current parent does not know the epxected child length\n\n    if (p.length < 0) {\n      return\n    }\n\n    p.length--\n\n    // All children were seen, we can close the current parent\n    if (p.length === 0) {\n      this._closeParent()\n    }\n  }\n\n  // Push any value to the current parent\n  _push (val, hasChildren) {\n    const p = this._currentParent\n    p.values++\n\n    switch (p.type) {\n      case c.PARENT.ARRAY:\n      case c.PARENT.BYTE_STRING:\n      case c.PARENT.UTF8_STRING:\n        if (p.length > -1) {\n          this._ref[this._ref.length - p.length] = val\n        } else {\n          this._ref.push(val)\n        }\n        this._dec()\n        break\n      case c.PARENT.OBJECT:\n        if (p.tmpKey != null) {\n          this._ref[p.tmpKey] = val\n          p.tmpKey = null\n          this._dec()\n        } else {\n          p.tmpKey = val\n\n          if (typeof p.tmpKey !== 'string') {\n            // too bad, convert to a Map\n            p.type = c.PARENT.MAP\n            p.ref = utils.buildMap(p.ref)\n          }\n        }\n        break\n      case c.PARENT.MAP:\n        if (p.tmpKey != null) {\n          this._ref.set(p.tmpKey, val)\n          p.tmpKey = null\n          this._dec()\n        } else {\n          p.tmpKey = val\n        }\n        break\n      case c.PARENT.TAG:\n        this._ref.push(val)\n        if (!hasChildren) {\n          this._dec()\n        }\n        break\n      default:\n        throw new Error('Unknown parent type')\n    }\n  }\n\n  // Create a new parent in the parents list\n  _createParent (obj, type, len) {\n    this._parents[this._depth] = {\n      type: type,\n      length: len,\n      ref: obj,\n      values: 0,\n      tmpKey: null\n    }\n  }\n\n  // Reset all state back to the beginning, also used for initiatlization\n  _reset () {\n    this._res = []\n    this._parents = [{\n      type: c.PARENT.ARRAY,\n      length: -1,\n      ref: this._res,\n      values: 0,\n      tmpKey: null\n    }]\n  }\n\n  // -- Interface to customize deoding behaviour\n  createTag (tagNumber, value) {\n    const typ = this._knownTags[tagNumber]\n\n    if (!typ) {\n      return new Tagged(tagNumber, value)\n    }\n\n    return typ(value)\n  }\n\n  createMap (obj, len) {\n    return obj\n  }\n\n  createObject (obj, len) {\n    return obj\n  }\n\n  createArray (arr, len) {\n    return arr\n  }\n\n  createByteString (raw, len) {\n    return Buffer.concat(raw)\n  }\n\n  createByteStringFromHeap (start, end) {\n    if (start === end) {\n      return Buffer.alloc(0)\n    }\n\n    return Buffer.from(this._heap.slice(start, end))\n  }\n\n  createInt (val) {\n    return val\n  }\n\n  createInt32 (f, g) {\n    return utils.buildInt32(f, g)\n  }\n\n  createInt64 (f1, f2, g1, g2) {\n    return utils.buildInt64(f1, f2, g1, g2)\n  }\n\n  createFloat (val) {\n    return val\n  }\n\n  createFloatSingle (a, b, c, d) {\n    return ieee754.read([a, b, c, d], 0, false, 23, 4)\n  }\n\n  createFloatDouble (a, b, c, d, e, f, g, h) {\n    return ieee754.read([a, b, c, d, e, f, g, h], 0, false, 52, 8)\n  }\n\n  createInt32Neg (f, g) {\n    return -1 - utils.buildInt32(f, g)\n  }\n\n  createInt64Neg (f1, f2, g1, g2) {\n    const f = utils.buildInt32(f1, f2)\n    const g = utils.buildInt32(g1, g2)\n\n    if (f > c.MAX_SAFE_HIGH) {\n      return c.NEG_ONE.minus(new Bignumber(f).times(c.SHIFT32).plus(g))\n    }\n\n    return -1 - ((f * c.SHIFT32) + g)\n  }\n\n  createTrue () {\n    return true\n  }\n\n  createFalse () {\n    return false\n  }\n\n  createNull () {\n    return null\n  }\n\n  createUndefined () {\n    return undefined\n  }\n\n  createInfinity () {\n    return Infinity\n  }\n\n  createInfinityNeg () {\n    return -Infinity\n  }\n\n  createNaN () {\n    return NaN\n  }\n\n  createNaNNeg () {\n    return -NaN\n  }\n\n  createUtf8String (raw, len) {\n    return raw.join('')\n  }\n\n  createUtf8StringFromHeap (start, end) {\n    if (start === end) {\n      return ''\n    }\n\n    return this._buffer.toString('utf8', start, end)\n  }\n\n  createSimpleUnassigned (val) {\n    return new Simple(val)\n  }\n\n  // -- Interface for decoder.asm.js\n\n  pushInt (val) {\n    this._push(this.createInt(val))\n  }\n\n  pushInt32 (f, g) {\n    this._push(this.createInt32(f, g))\n  }\n\n  pushInt64 (f1, f2, g1, g2) {\n    this._push(this.createInt64(f1, f2, g1, g2))\n  }\n\n  pushFloat (val) {\n    this._push(this.createFloat(val))\n  }\n\n  pushFloatSingle (a, b, c, d) {\n    this._push(this.createFloatSingle(a, b, c, d))\n  }\n\n  pushFloatDouble (a, b, c, d, e, f, g, h) {\n    this._push(this.createFloatDouble(a, b, c, d, e, f, g, h))\n  }\n\n  pushInt32Neg (f, g) {\n    this._push(this.createInt32Neg(f, g))\n  }\n\n  pushInt64Neg (f1, f2, g1, g2) {\n    this._push(this.createInt64Neg(f1, f2, g1, g2))\n  }\n\n  pushTrue () {\n    this._push(this.createTrue())\n  }\n\n  pushFalse () {\n    this._push(this.createFalse())\n  }\n\n  pushNull () {\n    this._push(this.createNull())\n  }\n\n  pushUndefined () {\n    this._push(this.createUndefined())\n  }\n\n  pushInfinity () {\n    this._push(this.createInfinity())\n  }\n\n  pushInfinityNeg () {\n    this._push(this.createInfinityNeg())\n  }\n\n  pushNaN () {\n    this._push(this.createNaN())\n  }\n\n  pushNaNNeg () {\n    this._push(this.createNaNNeg())\n  }\n\n  pushArrayStart () {\n    this._createParent([], c.PARENT.ARRAY, -1)\n  }\n\n  pushArrayStartFixed (len) {\n    this._createArrayStartFixed(len)\n  }\n\n  pushArrayStartFixed32 (len1, len2) {\n    const len = utils.buildInt32(len1, len2)\n    this._createArrayStartFixed(len)\n  }\n\n  pushArrayStartFixed64 (len1, len2, len3, len4) {\n    const len = utils.buildInt64(len1, len2, len3, len4)\n    this._createArrayStartFixed(len)\n  }\n\n  pushObjectStart () {\n    this._createObjectStartFixed(-1)\n  }\n\n  pushObjectStartFixed (len) {\n    this._createObjectStartFixed(len)\n  }\n\n  pushObjectStartFixed32 (len1, len2) {\n    const len = utils.buildInt32(len1, len2)\n    this._createObjectStartFixed(len)\n  }\n\n  pushObjectStartFixed64 (len1, len2, len3, len4) {\n    const len = utils.buildInt64(len1, len2, len3, len4)\n    this._createObjectStartFixed(len)\n  }\n\n  pushByteStringStart () {\n    this._parents[this._depth] = {\n      type: c.PARENT.BYTE_STRING,\n      length: -1,\n      ref: [],\n      values: 0,\n      tmpKey: null\n    }\n  }\n\n  pushByteString (start, end) {\n    this._push(this.createByteStringFromHeap(start, end))\n  }\n\n  pushUtf8StringStart () {\n    this._parents[this._depth] = {\n      type: c.PARENT.UTF8_STRING,\n      length: -1,\n      ref: [],\n      values: 0,\n      tmpKey: null\n    }\n  }\n\n  pushUtf8String (start, end) {\n    this._push(this.createUtf8StringFromHeap(start, end))\n  }\n\n  pushSimpleUnassigned (val) {\n    this._push(this.createSimpleUnassigned(val))\n  }\n\n  pushTagStart (tag) {\n    this._parents[this._depth] = {\n      type: c.PARENT.TAG,\n      length: 1,\n      ref: [tag]\n    }\n  }\n\n  pushTagStart4 (f, g) {\n    this.pushTagStart(utils.buildInt32(f, g))\n  }\n\n  pushTagStart8 (f1, f2, g1, g2) {\n    this.pushTagStart(utils.buildInt64(f1, f2, g1, g2))\n  }\n\n  pushTagUnassigned (tagNumber) {\n    this._push(this.createTag(tagNumber))\n  }\n\n  pushBreak () {\n    if (this._currentParent.length > -1) {\n      throw new Error('Unexpected break')\n    }\n\n    this._closeParent()\n  }\n\n  _createObjectStartFixed (len) {\n    if (len === 0) {\n      this._push(this.createObject({}))\n      return\n    }\n\n    this._createParent({}, c.PARENT.OBJECT, len)\n  }\n\n  _createArrayStartFixed (len) {\n    if (len === 0) {\n      this._push(this.createArray([]))\n      return\n    }\n\n    this._createParent(new Array(len), c.PARENT.ARRAY, len)\n  }\n\n  _decode (input) {\n    if (input.byteLength === 0) {\n      throw new Error('Input too short')\n    }\n\n    this._reset()\n    this._heap8.set(input)\n    const code = this.parser.parse(input.byteLength)\n\n    if (this._depth > 1) {\n      while (this._currentParent.length === 0) {\n        this._closeParent()\n      }\n      if (this._depth > 1) {\n        throw new Error('Undeterminated nesting')\n      }\n    }\n\n    if (code > 0) {\n      throw new Error('Failed to parse')\n    }\n\n    if (this._res.length === 0) {\n      throw new Error('No valid result')\n    }\n  }\n\n  // -- Public Interface\n\n  decodeFirst (input) {\n    this._decode(input)\n\n    return this._res[0]\n  }\n\n  decodeAll (input) {\n    this._decode(input)\n\n    return this._res\n  }\n\n  /**\n   * Decode the first cbor object.\n   *\n   * @param {Buffer|string} input\n   * @param {string} [enc='hex'] - Encoding used if a string is passed.\n   * @returns {*}\n   */\n  static decode (input, enc) {\n    if (typeof input === 'string') {\n      input = Buffer.from(input, enc || 'hex')\n    }\n\n    const dec = new Decoder({ size: input.length })\n    return dec.decodeFirst(input)\n  }\n\n  /**\n   * Decode all cbor objects.\n   *\n   * @param {Buffer|string} input\n   * @param {string} [enc='hex'] - Encoding used if a string is passed.\n   * @returns {Array<*>}\n   */\n  static decodeAll (input, enc) {\n    if (typeof input === 'string') {\n      input = Buffer.from(input, enc || 'hex')\n    }\n\n    const dec = new Decoder({ size: input.length })\n    return dec.decodeAll(input)\n  }\n}\n\nDecoder.decodeFirst = Decoder.decode\n\nmodule.exports = Decoder\n"]},"metadata":{},"sourceType":"script"}