{"ast":null,"code":"'use strict';\n\nvar _classCallCheck = require(\"/home/will/src/fstudy/client/node_modules/@babel/runtime/helpers/classCallCheck.js\").default;\n\nvar _createClass = require(\"/home/will/src/fstudy/client/node_modules/@babel/runtime/helpers/createClass.js\").default;\n\nvar bs58 = require('bs58');\n\nvar multihashing = require('multihashing-async');\n\nmodule.exports = function (keysProtobuf, randomBytes, crypto) {\n  crypto = crypto || require('./crypto')(randomBytes);\n\n  var Secp256k1PublicKey = /*#__PURE__*/function () {\n    function Secp256k1PublicKey(key) {\n      _classCallCheck(this, Secp256k1PublicKey);\n\n      crypto.validatePublicKey(key);\n      this._key = key;\n    }\n\n    _createClass(Secp256k1PublicKey, [{\n      key: \"verify\",\n      value: function verify(data, sig, callback) {\n        ensure(callback);\n        crypto.hashAndVerify(this._key, sig, data, callback);\n      }\n    }, {\n      key: \"marshal\",\n      value: function marshal() {\n        return crypto.compressPublicKey(this._key);\n      }\n    }, {\n      key: \"bytes\",\n      get: function get() {\n        return keysProtobuf.PublicKey.encode({\n          Type: keysProtobuf.KeyType.Secp256k1,\n          Data: this.marshal()\n        });\n      }\n    }, {\n      key: \"equals\",\n      value: function equals(key) {\n        return this.bytes.equals(key.bytes);\n      }\n    }, {\n      key: \"hash\",\n      value: function hash(callback) {\n        ensure(callback);\n        multihashing(this.bytes, 'sha2-256', callback);\n      }\n    }]);\n\n    return Secp256k1PublicKey;\n  }();\n\n  var Secp256k1PrivateKey = /*#__PURE__*/function () {\n    function Secp256k1PrivateKey(key, publicKey) {\n      _classCallCheck(this, Secp256k1PrivateKey);\n\n      this._key = key;\n      this._publicKey = publicKey || crypto.computePublicKey(key);\n      crypto.validatePrivateKey(this._key);\n      crypto.validatePublicKey(this._publicKey);\n    }\n\n    _createClass(Secp256k1PrivateKey, [{\n      key: \"sign\",\n      value: function sign(message, callback) {\n        ensure(callback);\n        crypto.hashAndSign(this._key, message, callback);\n      }\n    }, {\n      key: \"public\",\n      get: function get() {\n        return new Secp256k1PublicKey(this._publicKey);\n      }\n    }, {\n      key: \"marshal\",\n      value: function marshal() {\n        return this._key;\n      }\n    }, {\n      key: \"bytes\",\n      get: function get() {\n        return keysProtobuf.PrivateKey.encode({\n          Type: keysProtobuf.KeyType.Secp256k1,\n          Data: this.marshal()\n        });\n      }\n    }, {\n      key: \"equals\",\n      value: function equals(key) {\n        return this.bytes.equals(key.bytes);\n      }\n    }, {\n      key: \"hash\",\n      value: function hash(callback) {\n        ensure(callback);\n        multihashing(this.bytes, 'sha2-256', callback);\n      }\n      /**\n       * Gets the ID of the key.\n       *\n       * The key id is the base58 encoding of the SHA-256 multihash of its public key.\n       * The public key is a protobuf encoding containing a type and the DER encoding\n       * of the PKCS SubjectPublicKeyInfo.\n       *\n       * @param {function(Error, id)} callback\n       * @returns {undefined}\n       */\n\n    }, {\n      key: \"id\",\n      value: function id(callback) {\n        this.public.hash(function (err, hash) {\n          if (err) {\n            return callback(err);\n          }\n\n          callback(null, bs58.encode(hash));\n        });\n      }\n    }]);\n\n    return Secp256k1PrivateKey;\n  }();\n\n  function unmarshalSecp256k1PrivateKey(bytes, callback) {\n    callback(null, new Secp256k1PrivateKey(bytes));\n  }\n\n  function unmarshalSecp256k1PublicKey(bytes) {\n    return new Secp256k1PublicKey(bytes);\n  }\n\n  function generateKeyPair(_bits, callback) {\n    if (callback === undefined && typeof _bits === 'function') {\n      callback = _bits;\n    }\n\n    ensure(callback);\n    crypto.generateKey(function (err, privateKeyBytes) {\n      if (err) {\n        return callback(err);\n      }\n\n      var privkey;\n\n      try {\n        privkey = new Secp256k1PrivateKey(privateKeyBytes);\n      } catch (err) {\n        return callback(err);\n      }\n\n      callback(null, privkey);\n    });\n  }\n\n  function ensure(callback) {\n    if (typeof callback !== 'function') {\n      throw new Error('callback is required');\n    }\n  }\n\n  return {\n    Secp256k1PublicKey: Secp256k1PublicKey,\n    Secp256k1PrivateKey: Secp256k1PrivateKey,\n    unmarshalSecp256k1PrivateKey: unmarshalSecp256k1PrivateKey,\n    unmarshalSecp256k1PublicKey: unmarshalSecp256k1PublicKey,\n    generateKeyPair: generateKeyPair\n  };\n};","map":{"version":3,"sources":["/home/will/src/fstudy/client/node_modules/peer-id/node_modules/libp2p-crypto-secp256k1/src/index.js"],"names":["bs58","require","multihashing","module","exports","keysProtobuf","randomBytes","crypto","Secp256k1PublicKey","key","validatePublicKey","_key","data","sig","callback","ensure","hashAndVerify","compressPublicKey","PublicKey","encode","Type","KeyType","Secp256k1","Data","marshal","bytes","equals","Secp256k1PrivateKey","publicKey","_publicKey","computePublicKey","validatePrivateKey","message","hashAndSign","PrivateKey","public","hash","err","unmarshalSecp256k1PrivateKey","unmarshalSecp256k1PublicKey","generateKeyPair","_bits","undefined","generateKey","privateKeyBytes","privkey","Error"],"mappings":"AAAA;;;;;;AAEA,IAAMA,IAAI,GAAGC,OAAO,CAAC,MAAD,CAApB;;AACA,IAAMC,YAAY,GAAGD,OAAO,CAAC,oBAAD,CAA5B;;AAEAE,MAAM,CAACC,OAAP,GAAiB,UAACC,YAAD,EAAeC,WAAf,EAA4BC,MAA5B,EAAuC;AACtDA,EAAAA,MAAM,GAAGA,MAAM,IAAIN,OAAO,CAAC,UAAD,CAAP,CAAoBK,WAApB,CAAnB;;AADsD,MAGhDE,kBAHgD;AAIpD,gCAAaC,GAAb,EAAkB;AAAA;;AAChBF,MAAAA,MAAM,CAACG,iBAAP,CAAyBD,GAAzB;AACA,WAAKE,IAAL,GAAYF,GAAZ;AACD;;AAPmD;AAAA;AAAA,aASpD,gBAAQG,IAAR,EAAcC,GAAd,EAAmBC,QAAnB,EAA6B;AAC3BC,QAAAA,MAAM,CAACD,QAAD,CAAN;AACAP,QAAAA,MAAM,CAACS,aAAP,CAAqB,KAAKL,IAA1B,EAAgCE,GAAhC,EAAqCD,IAArC,EAA2CE,QAA3C;AACD;AAZmD;AAAA;AAAA,aAcpD,mBAAW;AACT,eAAOP,MAAM,CAACU,iBAAP,CAAyB,KAAKN,IAA9B,CAAP;AACD;AAhBmD;AAAA;AAAA,WAkBpD,eAAa;AACX,eAAON,YAAY,CAACa,SAAb,CAAuBC,MAAvB,CAA8B;AACnCC,UAAAA,IAAI,EAAEf,YAAY,CAACgB,OAAb,CAAqBC,SADQ;AAEnCC,UAAAA,IAAI,EAAE,KAAKC,OAAL;AAF6B,SAA9B,CAAP;AAID;AAvBmD;AAAA;AAAA,aAyBpD,gBAAQf,GAAR,EAAa;AACX,eAAO,KAAKgB,KAAL,CAAWC,MAAX,CAAkBjB,GAAG,CAACgB,KAAtB,CAAP;AACD;AA3BmD;AAAA;AAAA,aA6BpD,cAAMX,QAAN,EAAgB;AACdC,QAAAA,MAAM,CAACD,QAAD,CAAN;AACAZ,QAAAA,YAAY,CAAC,KAAKuB,KAAN,EAAa,UAAb,EAAyBX,QAAzB,CAAZ;AACD;AAhCmD;;AAAA;AAAA;;AAAA,MAmChDa,mBAnCgD;AAoCpD,iCAAalB,GAAb,EAAkBmB,SAAlB,EAA6B;AAAA;;AAC3B,WAAKjB,IAAL,GAAYF,GAAZ;AACA,WAAKoB,UAAL,GAAkBD,SAAS,IAAIrB,MAAM,CAACuB,gBAAP,CAAwBrB,GAAxB,CAA/B;AACAF,MAAAA,MAAM,CAACwB,kBAAP,CAA0B,KAAKpB,IAA/B;AACAJ,MAAAA,MAAM,CAACG,iBAAP,CAAyB,KAAKmB,UAA9B;AACD;;AAzCmD;AAAA;AAAA,aA2CpD,cAAMG,OAAN,EAAelB,QAAf,EAAyB;AACvBC,QAAAA,MAAM,CAACD,QAAD,CAAN;AACAP,QAAAA,MAAM,CAAC0B,WAAP,CAAmB,KAAKtB,IAAxB,EAA8BqB,OAA9B,EAAuClB,QAAvC;AACD;AA9CmD;AAAA;AAAA,WAgDpD,eAAc;AACZ,eAAO,IAAIN,kBAAJ,CAAuB,KAAKqB,UAA5B,CAAP;AACD;AAlDmD;AAAA;AAAA,aAoDpD,mBAAW;AACT,eAAO,KAAKlB,IAAZ;AACD;AAtDmD;AAAA;AAAA,WAwDpD,eAAa;AACX,eAAON,YAAY,CAAC6B,UAAb,CAAwBf,MAAxB,CAA+B;AACpCC,UAAAA,IAAI,EAAEf,YAAY,CAACgB,OAAb,CAAqBC,SADS;AAEpCC,UAAAA,IAAI,EAAE,KAAKC,OAAL;AAF8B,SAA/B,CAAP;AAID;AA7DmD;AAAA;AAAA,aA+DpD,gBAAQf,GAAR,EAAa;AACX,eAAO,KAAKgB,KAAL,CAAWC,MAAX,CAAkBjB,GAAG,CAACgB,KAAtB,CAAP;AACD;AAjEmD;AAAA;AAAA,aAmEpD,cAAMX,QAAN,EAAgB;AACdC,QAAAA,MAAM,CAACD,QAAD,CAAN;AACAZ,QAAAA,YAAY,CAAC,KAAKuB,KAAN,EAAa,UAAb,EAAyBX,QAAzB,CAAZ;AACD;AAED;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAjFwD;AAAA;AAAA,aAkFpD,YAAIA,QAAJ,EAAc;AACZ,aAAKqB,MAAL,CAAYC,IAAZ,CAAiB,UAACC,GAAD,EAAMD,IAAN,EAAe;AAC9B,cAAIC,GAAJ,EAAS;AACP,mBAAOvB,QAAQ,CAACuB,GAAD,CAAf;AACD;;AACDvB,UAAAA,QAAQ,CAAC,IAAD,EAAOd,IAAI,CAACmB,MAAL,CAAYiB,IAAZ,CAAP,CAAR;AACD,SALD;AAMD;AAzFmD;;AAAA;AAAA;;AA4FtD,WAASE,4BAAT,CAAuCb,KAAvC,EAA8CX,QAA9C,EAAwD;AACtDA,IAAAA,QAAQ,CAAC,IAAD,EAAO,IAAIa,mBAAJ,CAAwBF,KAAxB,CAAP,CAAR;AACD;;AAED,WAASc,2BAAT,CAAsCd,KAAtC,EAA6C;AAC3C,WAAO,IAAIjB,kBAAJ,CAAuBiB,KAAvB,CAAP;AACD;;AAED,WAASe,eAAT,CAA0BC,KAA1B,EAAiC3B,QAAjC,EAA2C;AACzC,QAAIA,QAAQ,KAAK4B,SAAb,IAA0B,OAAOD,KAAP,KAAiB,UAA/C,EAA2D;AACzD3B,MAAAA,QAAQ,GAAG2B,KAAX;AACD;;AAED1B,IAAAA,MAAM,CAACD,QAAD,CAAN;AAEAP,IAAAA,MAAM,CAACoC,WAAP,CAAmB,UAACN,GAAD,EAAMO,eAAN,EAA0B;AAC3C,UAAIP,GAAJ,EAAS;AAAE,eAAOvB,QAAQ,CAACuB,GAAD,CAAf;AAAsB;;AAEjC,UAAIQ,OAAJ;;AACA,UAAI;AACFA,QAAAA,OAAO,GAAG,IAAIlB,mBAAJ,CAAwBiB,eAAxB,CAAV;AACD,OAFD,CAEE,OAAOP,GAAP,EAAY;AAAE,eAAOvB,QAAQ,CAACuB,GAAD,CAAf;AAAsB;;AAEtCvB,MAAAA,QAAQ,CAAC,IAAD,EAAO+B,OAAP,CAAR;AACD,KATD;AAUD;;AAED,WAAS9B,MAAT,CAAiBD,QAAjB,EAA2B;AACzB,QAAI,OAAOA,QAAP,KAAoB,UAAxB,EAAoC;AAClC,YAAM,IAAIgC,KAAJ,CAAU,sBAAV,CAAN;AACD;AACF;;AAED,SAAO;AACLtC,IAAAA,kBAAkB,EAAlBA,kBADK;AAELmB,IAAAA,mBAAmB,EAAnBA,mBAFK;AAGLW,IAAAA,4BAA4B,EAA5BA,4BAHK;AAILC,IAAAA,2BAA2B,EAA3BA,2BAJK;AAKLC,IAAAA,eAAe,EAAfA;AALK,GAAP;AAOD,CApID","sourcesContent":["'use strict'\n\nconst bs58 = require('bs58')\nconst multihashing = require('multihashing-async')\n\nmodule.exports = (keysProtobuf, randomBytes, crypto) => {\n  crypto = crypto || require('./crypto')(randomBytes)\n\n  class Secp256k1PublicKey {\n    constructor (key) {\n      crypto.validatePublicKey(key)\n      this._key = key\n    }\n\n    verify (data, sig, callback) {\n      ensure(callback)\n      crypto.hashAndVerify(this._key, sig, data, callback)\n    }\n\n    marshal () {\n      return crypto.compressPublicKey(this._key)\n    }\n\n    get bytes () {\n      return keysProtobuf.PublicKey.encode({\n        Type: keysProtobuf.KeyType.Secp256k1,\n        Data: this.marshal()\n      })\n    }\n\n    equals (key) {\n      return this.bytes.equals(key.bytes)\n    }\n\n    hash (callback) {\n      ensure(callback)\n      multihashing(this.bytes, 'sha2-256', callback)\n    }\n  }\n\n  class Secp256k1PrivateKey {\n    constructor (key, publicKey) {\n      this._key = key\n      this._publicKey = publicKey || crypto.computePublicKey(key)\n      crypto.validatePrivateKey(this._key)\n      crypto.validatePublicKey(this._publicKey)\n    }\n\n    sign (message, callback) {\n      ensure(callback)\n      crypto.hashAndSign(this._key, message, callback)\n    }\n\n    get public () {\n      return new Secp256k1PublicKey(this._publicKey)\n    }\n\n    marshal () {\n      return this._key\n    }\n\n    get bytes () {\n      return keysProtobuf.PrivateKey.encode({\n        Type: keysProtobuf.KeyType.Secp256k1,\n        Data: this.marshal()\n      })\n    }\n\n    equals (key) {\n      return this.bytes.equals(key.bytes)\n    }\n\n    hash (callback) {\n      ensure(callback)\n      multihashing(this.bytes, 'sha2-256', callback)\n    }\n\n    /**\n     * Gets the ID of the key.\n     *\n     * The key id is the base58 encoding of the SHA-256 multihash of its public key.\n     * The public key is a protobuf encoding containing a type and the DER encoding\n     * of the PKCS SubjectPublicKeyInfo.\n     *\n     * @param {function(Error, id)} callback\n     * @returns {undefined}\n     */\n    id (callback) {\n      this.public.hash((err, hash) => {\n        if (err) {\n          return callback(err)\n        }\n        callback(null, bs58.encode(hash))\n      })\n    }\n  }\n\n  function unmarshalSecp256k1PrivateKey (bytes, callback) {\n    callback(null, new Secp256k1PrivateKey(bytes))\n  }\n\n  function unmarshalSecp256k1PublicKey (bytes) {\n    return new Secp256k1PublicKey(bytes)\n  }\n\n  function generateKeyPair (_bits, callback) {\n    if (callback === undefined && typeof _bits === 'function') {\n      callback = _bits\n    }\n\n    ensure(callback)\n\n    crypto.generateKey((err, privateKeyBytes) => {\n      if (err) { return callback(err) }\n\n      let privkey\n      try {\n        privkey = new Secp256k1PrivateKey(privateKeyBytes)\n      } catch (err) { return callback(err) }\n\n      callback(null, privkey)\n    })\n  }\n\n  function ensure (callback) {\n    if (typeof callback !== 'function') {\n      throw new Error('callback is required')\n    }\n  }\n\n  return {\n    Secp256k1PublicKey,\n    Secp256k1PrivateKey,\n    unmarshalSecp256k1PrivateKey,\n    unmarshalSecp256k1PublicKey,\n    generateKeyPair\n  }\n}\n"]},"metadata":{},"sourceType":"script"}